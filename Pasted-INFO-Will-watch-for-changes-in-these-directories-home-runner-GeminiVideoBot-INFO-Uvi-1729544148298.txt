INFO:     Will watch for changes in these directories: ['/home/runner/GeminiVideoBot']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [229] using StatReload
INFO:     Started server process [242]
INFO:     Waiting for application startup.
INFO:app:Redis client initialized successfully
INFO:redis_config:Successfully connected to Redis
INFO:app:Redis connection test passed
INFO:     Application startup complete.
INFO:     172.31.196.31:34480 - "GET / HTTP/1.1" 200 OK
INFO:     172.31.196.31:34480 - "GET / HTTP/1.1" 200 OK
INFO:     172.31.196.31:34480 - "GET /styles.css HTTP/1.1" 200 OK
INFO:     172.31.196.31:34480 - "GET /auth_status HTTP/1.1" 200 OK
INFO:     172.31.196.31:34480 - "GET /login HTTP/1.1" 200 OK
INFO:     172.31.196.31:34480 - "GET /auth_status HTTP/1.1" 200 OK
INFO:app:Fetching chat history for user: e5fb9299-3a16-4453-9586-2735c521d843
INFO:httpx:HTTP Request: GET https://xghbfotsivdbuqvumyyu.supabase.co/rest/v1/user_chat_history?select=%2A&user_id=eq.e5fb9299-3a16-4453-9586-2735c521d843&order=COALESCE%28timestamp%2C%20CURRENT_TIMESTAMP%29.desc&limit=50 "HTTP/1.1 400 Bad Request"
ERROR:app:Unexpected error in chat_history endpoint: {'code': 'PGRST100', 'details': 'unexpected \'(\' expecting letter, digit, "-", "->>", "->", delimiter (.), "," or end of input', 'hint': None, 'message': '"failed to parse order (COALESCE(timestamp, CURRENT_TIMESTAMP).desc)" (line 1, column 9)'}
ERROR:app:Traceback (most recent call last):
  File "/home/runner/GeminiVideoBot/app.py", line 202, in chat_history
    history = get_chat_history(user_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/GeminiVideoBot/database.py", line 75, in get_chat_history
    response = supabase.table("user_chat_history").select("*").eq("user_id", str(user_id)).order("COALESCE(timestamp, CURRENT_TIMESTAMP)", desc=True).limit(limit).execute()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/GeminiVideoBot/.pythonlibs/lib/python3.11/site-packages/postgrest/_sync/request_builder.py", line 70, in execute
    raise APIError(r.json())
postgrest.exceptions.APIError: {'code': 'PGRST100', 'details': 'unexpected \'(\' expecting letter, digit, "-", "->>", "->", delimiter (.), "," or end of input', 'hint': None, 'message': '"failed to parse order (COALESCE(timestamp, CURRENT_TIMESTAMP).desc)" (line 1, column 9)'}

ERROR:app:Error occurred after 0.72 seconds
INFO:     172.31.196.31:34480 - "GET /chat_history HTTP/1.1" 500 Internal Server Error
INFO:httpx:HTTP Request: GET https://xghbfotsivdbuqvumyyu.supabase.co/rest/v1/video_analysis_output?select=%2A&user_id=eq.e5fb9299-3a16-4453-9586-2735c521d843&order=COALESCE%28timestamp%2C%20CURRENT_TIMESTAMP%29.desc&limit=10 "HTTP/1.1 400 Bad Request"
ERROR:app:Error in video_analysis_history endpoint: {'code': 'PGRST100', 'details': 'unexpected \'(\' expecting letter, digit, "-", "->>", "->", delimiter (.), "," or end of input', 'hint': None, 'message': '"failed to parse order (COALESCE(timestamp, CURRENT_TIMESTAMP).desc)" (line 1, column 9)'}
INFO:     172.31.196.31:34496 - "GET /video_analysis_history HTTP/1.1" 500 Internal Server Error
INFO:     172.31.196.31:57630 - "GET / HTTP/1.1" 200 OK
INFO:     172.31.196.31:57630 - "GET /auth_status HTTP/1.1" 200 OK
INFO:app:Fetching chat history for user: e5fb9299-3a16-4453-9586-2735c521d843
INFO:httpx:HTTP Request: GET https://xghbfotsivdbuqvumyyu.supabase.co/rest/v1/user_chat_history?select=%2A&user_id=eq.e5fb9299-3a16-4453-9586-2735c521d843&order=COALESCE%28timestamp%2C%20CURRENT_TIMESTAMP%29.desc&limit=50 "HTTP/1.1 400 Bad Request"
ERROR:app:Unexpected error in chat_history endpoint: {'code': 'PGRST100', 'details': 'unexpected \'(\' expecting letter, digit, "-", "->>", "->", delimiter (.), "," or end of input', 'hint': None, 'message': '"failed to parse order (COALESCE(timestamp, CURRENT_TIMESTAMP).desc)" (line 1, column 9)'}
ERROR:app:Traceback (most recent call last):
  File "/home/runner/GeminiVideoBot/app.py", line 202, in chat_history
    history = get_chat_history(user_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/GeminiVideoBot/database.py", line 75, in get_chat_history
    response = supabase.table("user_chat_history").select("*").eq("user_id", str(user_id)).order("COALESCE(timestamp, CURRENT_TIMESTAMP)", desc=True).limit(limit).execute()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/GeminiVideoBot/.pythonlibs/lib/python3.11/site-packages/postgrest/_sync/request_builder.py", line 70, in execute
    raise APIError(r.json())
postgrest.exceptions.APIError: {'code': 'PGRST100', 'details': 'unexpected \'(\' expecting letter, digit, "-", "->>", "->", delimiter (.), "," or end of input', 'hint': None, 'message': '"failed to parse order (COALESCE(timestamp, CURRENT_TIMESTAMP).desc)" (line 1, column 9)'}

ERROR:app:Error occurred after 1.22 seconds
INFO:     172.31.196.31:57630 - "GET /chat_history HTTP/1.1" 500 Internal Server Error
INFO:httpx:HTTP Request: GET https://xghbfotsivdbuqvumyyu.supabase.co/rest/v1/video_analysis_output?select=%2A&user_id=eq.e5fb9299-3a16-4453-9586-2735c521d843&order=COALESCE%28timestamp%2C%20CURRENT_TIMESTAMP%29.desc&limit=10 "HTTP/1.1 400 Bad Request"
ERROR:app:Error in video_analysis_history endpoint: {'code': 'PGRST100', 'details': 'unexpected \'(\' expecting letter, digit, "-", "->>", "->", delimiter (.), "," or end of input', 'hint': None, 'message': '"failed to parse order (COALESCE(timestamp, CURRENT_TIMESTAMP).desc)" (line 1, column 9)'}
INFO:     172.31.196.31:57632 - "GET /video_analysis_history HTTP/1.1" 500 Internal Server Error
INFO:httpx:HTTP Request: GET https://xghbfotsivdbuqvumyyu.supabase.co/rest/v1/users?select=id&id=eq.e5fb9299-3a16-4453-9586-2735c521d843 "HTTP/1.1 200 OK"
INFO:     172.31.196.31:50480 - "POST /send_message HTTP/1.1" 200 OK
INFO:app:Fetching chat history for user: e5fb9299-3a16-4453-9586-2735c521d843
INFO:app:Total chat history processing time: 0.22 seconds
INFO:     172.31.196.31:50480 - "GET /chat_history HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://xghbfotsivdbuqvumyyu.supabase.co/rest/v1/video_analysis_output?select=%2A&user_id=eq.e5fb9299-3a16-4453-9586-2735c521d843&order=COALESCE%28timestamp%2C%20CURRENT_TIMESTAMP%29.desc&limit=10 "HTTP/1.1 400 Bad Request"
ERROR:app:Error in video_analysis_history endpoint: {'code': 'PGRST100', 'details': 'unexpected \'(\' expecting letter, digit, "-", "->>", "->", delimiter (.), "," or end of input', 'hint': None, 'message': '"failed to parse order (COALESCE(timestamp, CURRENT_TIMESTAMP).desc)" (line 1, column 9)'}
INFO:     172.31.196.31:37260 - "GET /video_analysis_history HTTP/1.1" 500 Internal Server Error